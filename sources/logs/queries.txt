IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='Subscription' AND xtype='U') CREATE TABLE Subscription (ID VARCHAR(36), Name VARCHAR(50), LastName VARCHAR(50), Street VARCHAR(50), HouseNumber TINYINT, Postcode VARCHAR(6), City VARCHAR(50) CONSTRAINT PKSubscription PRIMARY KEY (ID));
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='Profile' AND xtype='U') CREATE TABLE Profile (ProfileName VARCHAR(50), Age TINYINT, ID VARCHAR(36) CONSTRAINT PKProfilePK PRIMARY KEY (ProfileName,ID), CONSTRAINT FKProfileFK FOREIGN KEY (ID) REFERENCES Subscription (ID) ON DELETE CASCADE);
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='Program' AND xtype='U') CREATE TABLE Program (ID VARCHAR(36), Title VARCHAR(50), Genre VARCHAR(50) CONSTRAINT PKTable PRIMARY KEY (ID));
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='Movie' AND xtype='U') CREATE TABLE Movie (AgeIndication TINYINT, Duration INT, ID VARCHAR(36) CONSTRAINT PKMovie PRIMARY KEY (ID), CONSTRAINT FKMovie FOREIGN KEY (ID) REFERENCES Program (ID) ON DELETE CASCADE);
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='Serie' AND xtype='U') CREATE TABLE Serie (ID VARCHAR(36) CONSTRAINT PKSerie PRIMARY KEY (ID), CONSTRAINT FKSerie FOREIGN KEY (ID) REFERENCES Program (ID) ON DELETE CASCADE);
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='Episode' AND xtype='U') CREATE TABLE Episode (ID VARCHAR(36), EpisodeNumber INT, Duration INT, Title VARCHAR(50), NextID VARCHAR(36), NextEpisode INT CONSTRAINT PKEpisode PRIMARY KEY (EpisodeNumber,ID), CONSTRAINT FKEpisode FOREIGN KEY (NextEpisode,NextID) REFERENCES Episode (EpisodeNumber,ID), CONSTRAINT FKEpisodeSerie FOREIGN KEY (ID) REFERENCES Serie (ID) ON DELETE CASCADE);
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='BehaviourSerie' AND xtype='U') CREATE TABLE BehaviourSerie (ID VARCHAR(36), ProfileName VARCHAR(50), ProgramID VARCHAR(36), EpisodeNumber INT, CurrentDuration INT CONSTRAINT PKBehaviourSerie PRIMARY KEY (ID,ProfileName,ProgramID,EpisodeNumber), CONSTRAINT FKBehaviourSerieProfile FOREIGN KEY (ProfileName,ID) REFERENCES Profile (ProfileName,ID) ON DELETE CASCADE, CONSTRAINT FKBehaviourSerieEpisode FOREIGN KEY (EpisodeNumber,ProgramID) REFERENCES Episode (EpisodeNumber,ID) ON DELETE CASCADE);
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='BehaviourMovie' AND xtype='U') CREATE TABLE BehaviourMovie (ID VARCHAR(36), ProfileName VARCHAR(50), ProgramID VARCHAR(36), CurrentDuration INT CONSTRAINT PKBehaviourMovie PRIMARY KEY (ID,ProfileName,ProgramID), CONSTRAINT FKBehaviourMovieProfile FOREIGN KEY (ProfileName,ID) REFERENCES Profile (ProfileName,ID) ON DELETE CASCADE, CONSTRAINT FKBehaviourMovieMovie FOREIGN KEY (ProgramID) REFERENCES Movie (ID) ON DELETE CASCADE);
IF OBJECT_ID('dbo.PKSubscription', 'C') IS NOT NULL ALTER TABLE dbo.Subscription ADD CONSTRAINT PKSubscription PRIMARY KEY (ID);
IF OBJECT_ID('dbo.PKProfilePK', 'C') IS NOT NULL ALTER TABLE dbo.Profile ADD CONSTRAINT PKProfilePK PRIMARY KEY (ProfileName,ID);
IF OBJECT_ID('dbo.FKProfileFK', 'C') IS NOT NULL ALTER TABLE dbo.Profile ADD CONSTRAINT FKProfileFK FOREIGN KEY (ID) REFERENCES Subscription (ID) ON DELETE CASCADE;
IF OBJECT_ID('dbo.PKTable', 'C') IS NOT NULL ALTER TABLE dbo.Program ADD CONSTRAINT PKTable PRIMARY KEY (ID);
IF OBJECT_ID('dbo.PKMovie', 'C') IS NOT NULL ALTER TABLE dbo.Movie ADD CONSTRAINT PKMovie PRIMARY KEY (ID);
IF OBJECT_ID('dbo.FKMovie', 'C') IS NOT NULL ALTER TABLE dbo.Movie ADD CONSTRAINT FKMovie FOREIGN KEY (ID) REFERENCES Program (ID) ON DELETE CASCADE;
IF OBJECT_ID('dbo.PKSerie', 'C') IS NOT NULL ALTER TABLE dbo.Serie ADD CONSTRAINT PKSerie PRIMARY KEY (ID);
IF OBJECT_ID('dbo.FKSerie', 'C') IS NOT NULL ALTER TABLE dbo.Serie ADD CONSTRAINT FKSerie FOREIGN KEY (ID) REFERENCES Program (ID) ON DELETE CASCADE;
IF OBJECT_ID('dbo.PKEpisode', 'C') IS NOT NULL ALTER TABLE dbo.Episode ADD CONSTRAINT PKEpisode PRIMARY KEY (EpisodeNumber,ID);
IF OBJECT_ID('dbo.FKEpisode', 'C') IS NOT NULL ALTER TABLE dbo.Episode ADD CONSTRAINT FKEpisode FOREIGN KEY (NextEpisode,NextID) REFERENCES Episode (EpisodeNumber,ID);
IF OBJECT_ID('dbo.FKEpisodeSerie', 'C') IS NOT NULL ALTER TABLE dbo.Episode ADD CONSTRAINT FKEpisodeSerie FOREIGN KEY (ID) REFERENCES Serie (ID) ON DELETE CASCADE;
IF OBJECT_ID('dbo.PKBehaviourSerie', 'C') IS NOT NULL ALTER TABLE dbo.BehaviourSerie ADD CONSTRAINT PKBehaviourSerie PRIMARY KEY (ID,ProfileName,ProgramID,EpisodeNumber);
IF OBJECT_ID('dbo.FKBehaviourSerieProfile', 'C') IS NOT NULL ALTER TABLE dbo.BehaviourSerie ADD CONSTRAINT FKBehaviourSerieProfile FOREIGN KEY (ProfileName,ID) REFERENCES Profile (ProfileName,ID) ON DELETE CASCADE;
IF OBJECT_ID('dbo.FKBehaviourSerieEpisode', 'C') IS NOT NULL ALTER TABLE dbo.BehaviourSerie ADD CONSTRAINT FKBehaviourSerieEpisode FOREIGN KEY (EpisodeNumber,ProgramID) REFERENCES Episode (EpisodeNumber,ID) ON DELETE CASCADE;
IF OBJECT_ID('dbo.PKBehaviourMovie', 'C') IS NOT NULL ALTER TABLE dbo.BehaviourMovie ADD CONSTRAINT PKBehaviourMovie PRIMARY KEY (ID,ProfileName,ProgramID);
IF OBJECT_ID('dbo.FKBehaviourMovieProfile', 'C') IS NOT NULL ALTER TABLE dbo.BehaviourMovie ADD CONSTRAINT FKBehaviourMovieProfile FOREIGN KEY (ProfileName,ID) REFERENCES Profile (ProfileName,ID) ON DELETE CASCADE;
IF OBJECT_ID('dbo.FKBehaviourMovieMovie', 'C') IS NOT NULL ALTER TABLE dbo.BehaviourMovie ADD CONSTRAINT FKBehaviourMovieMovie FOREIGN KEY (ProgramID) REFERENCES Movie (ID) ON DELETE CASCADE;
SELECT Program.ID, Program.Title, Movie.Duration FROM Program INNER JOIN Movie ON (Program.ID = Movie.ID);
SELECT Program.ID, Program.Title FROM Program INNER JOIN Serie ON (Program.ID = Serie.ID);
SELECT Subscription.ID, Subscription.Name, Subscription.LastName FROM Subscription;
SELECT Subscription.Street, Subscription.HouseNumber, Subscription.Postcode, Subscription.City FROM Subscription WHERE Subscription.ID='35e8fdfe-dccd-4c56-8b33-825083c3fdea';
SELECT COUNT(*) AS count FROM Profile  WHERE Profile.ID='35e8fdfe-dccd-4c56-8b33-825083c3fdea';
SELECT Subscription.ID FROM Subscription WHERE Subscription.ID='35e8fdfe-dccd-4c56-8b33-825083c3fdea';
INSERT INTO Subscription (Subscription.ID, Subscription.Name, Subscription.LastName, Subscription.Street, Subscription.HouseNumber, Subscription.Postcode, Subscription.City) VALUES ('35e8fdfe-dccd-4c56-8b33-825083c3fdea','Robin','Egberts',NULL,'0',NULL,NULL);
SELECT Profile.ID FROM Profile WHERE Profile.ID='35e8fdfe-dccd-4c56-8b33-825083c3fdea' AND Profile.ProfileName='kids';
INSERT INTO Profile (Profile.ProfileName, Profile.Age, Profile.ID) VALUES ('kids','15','35e8fdfe-dccd-4c56-8b33-825083c3fdea');
SELECT Program.ID FROM Program WHERE Program.ID='2b9af7bb-d95e-4244-9af1-d5d4046fcc01';
INSERT INTO Program (Program.ID, Program.Title, Program.Genre) VALUES ('2b9af7bb-d95e-4244-9af1-d5d4046fcc01','GodFather','Criminals');
SELECT Movie.ID FROM Movie WHERE Movie.ID='2b9af7bb-d95e-4244-9af1-d5d4046fcc01';
INSERT INTO Movie (Movie.AgeIndication, Movie.Duration, Movie.ID) VALUES ('18','120','2b9af7bb-d95e-4244-9af1-d5d4046fcc01');
SELECT Episode.EpisodeNumber, Episode.Duration, Episode.Title, Episode.NextEpisode FROM Serie INNER JOIN Episode ON (Serie.ID = Episode.ID) WHERE Serie.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
SELECT Program.ID FROM Program WHERE Program.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
INSERT INTO Program (Program.ID, Program.Title, Program.Genre) VALUES ('44110464-7fa4-4e86-b2a2-b7c01053b376','The Flash','Superheroes');
SELECT Serie.ID FROM Serie WHERE Serie.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
INSERT INTO Serie (Serie.ID) VALUES ('44110464-7fa4-4e86-b2a2-b7c01053b376');
SELECT Episode.EpisodeNumber, Episode.Duration, Episode.Title, Episode.NextEpisode FROM Serie INNER JOIN Episode ON (Serie.ID = Episode.ID) WHERE Serie.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
SELECT Program.ID FROM Program WHERE Program.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
UPDATE Program  SET Genre='Superheroes' WHERE Program.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
SELECT Serie.ID FROM Serie WHERE Serie.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
INSERT INTO Episode (Episode.ID, Episode.EpisodeNumber, Episode.Duration, Episode.Title, Episode.NextID, Episode.NextEpisode) VALUES ('44110464-7fa4-4e86-b2a2-b7c01053b376','1','41','A new Begging',NULL,NULL);
INSERT INTO Episode (Episode.ID, Episode.EpisodeNumber, Episode.Duration, Episode.Title, Episode.NextID, Episode.NextEpisode) VALUES ('44110464-7fa4-4e86-b2a2-b7c01053b376','2','40','A new Begging',NULL,NULL);
UPDATE Episode  SET NextEpisode='2',NextID='44110464-7fa4-4e86-b2a2-b7c01053b376' WHERE Episode.EpisodeNumber='1' AND Episode.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
INSERT INTO Episode (Episode.ID, Episode.EpisodeNumber, Episode.Duration, Episode.Title, Episode.NextID, Episode.NextEpisode) VALUES ('44110464-7fa4-4e86-b2a2-b7c01053b376','3','42','A new Begging',NULL,NULL);
UPDATE Episode  SET NextEpisode='3',NextID='44110464-7fa4-4e86-b2a2-b7c01053b376' WHERE Episode.EpisodeNumber='2' AND Episode.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
INSERT INTO Episode (Episode.ID, Episode.EpisodeNumber, Episode.Duration, Episode.Title, Episode.NextID, Episode.NextEpisode) VALUES ('44110464-7fa4-4e86-b2a2-b7c01053b376','4','41','A new Begging',NULL,NULL);
UPDATE Episode  SET NextEpisode='4',NextID='44110464-7fa4-4e86-b2a2-b7c01053b376' WHERE Episode.EpisodeNumber='3' AND Episode.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
INSERT INTO Episode (Episode.ID, Episode.EpisodeNumber, Episode.Duration, Episode.Title, Episode.NextID, Episode.NextEpisode) VALUES ('44110464-7fa4-4e86-b2a2-b7c01053b376','5','40','A new Begging',NULL,NULL);
UPDATE Episode  SET NextEpisode='5',NextID='44110464-7fa4-4e86-b2a2-b7c01053b376' WHERE Episode.EpisodeNumber='4' AND Episode.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
INSERT INTO Episode (Episode.ID, Episode.EpisodeNumber, Episode.Duration, Episode.Title, Episode.NextID, Episode.NextEpisode) VALUES ('44110464-7fa4-4e86-b2a2-b7c01053b376','6','42','A new Begging',NULL,NULL);
UPDATE Episode  SET NextEpisode='6',NextID='44110464-7fa4-4e86-b2a2-b7c01053b376' WHERE Episode.EpisodeNumber='5' AND Episode.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
INSERT INTO Episode (Episode.ID, Episode.EpisodeNumber, Episode.Duration, Episode.Title, Episode.NextID, Episode.NextEpisode) VALUES ('44110464-7fa4-4e86-b2a2-b7c01053b376','7','43','A new Begging',NULL,NULL);
UPDATE Episode  SET NextEpisode='7',NextID='44110464-7fa4-4e86-b2a2-b7c01053b376' WHERE Episode.EpisodeNumber='6' AND Episode.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
INSERT INTO Episode (Episode.ID, Episode.EpisodeNumber, Episode.Duration, Episode.Title, Episode.NextID, Episode.NextEpisode) VALUES ('44110464-7fa4-4e86-b2a2-b7c01053b376','8','40','A new Begging',NULL,NULL);
UPDATE Episode  SET NextEpisode='8',NextID='44110464-7fa4-4e86-b2a2-b7c01053b376' WHERE Episode.EpisodeNumber='7' AND Episode.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
INSERT INTO Episode (Episode.ID, Episode.EpisodeNumber, Episode.Duration, Episode.Title, Episode.NextID, Episode.NextEpisode) VALUES ('44110464-7fa4-4e86-b2a2-b7c01053b376','9','42','A new Begging',NULL,NULL);
UPDATE Episode  SET NextEpisode='9',NextID='44110464-7fa4-4e86-b2a2-b7c01053b376' WHERE Episode.EpisodeNumber='8' AND Episode.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
SELECT BehaviourSerie.ProgramID FROM BehaviourSerie WHERE BehaviourSerie.ID='35e8fdfe-dccd-4c56-8b33-825083c3fdea' AND BehaviourSerie.ProfileName='kids' AND BehaviourSerie.ProgramID='44110464-7fa4-4e86-b2a2-b7c01053b376' AND BehaviourSerie.EpisodeNumber='1';
INSERT INTO BehaviourSerie (BehaviourSerie.ID, BehaviourSerie.ProfileName, BehaviourSerie.ProgramID, BehaviourSerie.EpisodeNumber, BehaviourSerie.CurrentDuration) VALUES ('35e8fdfe-dccd-4c56-8b33-825083c3fdea','kids','44110464-7fa4-4e86-b2a2-b7c01053b376','1','40');
SELECT Subscription.ID FROM Subscription WHERE Subscription.ID='35e8fdfe-dccd-4c56-8b33-825083c3fdea';
UPDATE Subscription  SET Street='Gripvelden',HouseNumber='82',Postcode='4707ZG',City='Roosendaal' WHERE Subscription.ID='35e8fdfe-dccd-4c56-8b33-825083c3fdea';
SELECT Profile.ID FROM Profile WHERE Profile.ID='35e8fdfe-dccd-4c56-8b33-825083c3fdea' AND Profile.ProfileName='kids';
UPDATE Profile  SET ProfileName='kids',Age='15' WHERE Profile.ProfileName='kids' AND Profile.ID='35e8fdfe-dccd-4c56-8b33-825083c3fdea';
SELECT Program.ID FROM Program WHERE Program.ID='2b9af7bb-d95e-4244-9af1-d5d4046fcc01';
UPDATE Program  SET Genre='Criminals' WHERE Program.ID='2b9af7bb-d95e-4244-9af1-d5d4046fcc01';
SELECT Movie.ID FROM Movie WHERE Movie.ID='2b9af7bb-d95e-4244-9af1-d5d4046fcc01';
UPDATE Movie  SET AgeIndication='18' WHERE Movie.ID='2b9af7bb-d95e-4244-9af1-d5d4046fcc01';
SELECT Program.ID FROM Program WHERE Program.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
UPDATE Program  SET Genre='Superheroes' WHERE Program.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
SELECT Serie.ID FROM Serie WHERE Serie.ID='44110464-7fa4-4e86-b2a2-b7c01053b376';
SELECT Episode.EpisodeNumber FROM Serie INNER JOIN Episode ON (Serie.ID = Episode.ID) WHERE Episode.EpisodeNumber='1';
SELECT Episode.EpisodeNumber FROM Serie INNER JOIN Episode ON (Serie.ID = Episode.ID) WHERE Episode.EpisodeNumber='2';
SELECT Episode.EpisodeNumber FROM Serie INNER JOIN Episode ON (Serie.ID = Episode.ID) WHERE Episode.EpisodeNumber='3';
SELECT Episode.EpisodeNumber FROM Serie INNER JOIN Episode ON (Serie.ID = Episode.ID) WHERE Episode.EpisodeNumber='4';
SELECT Episode.EpisodeNumber FROM Serie INNER JOIN Episode ON (Serie.ID = Episode.ID) WHERE Episode.EpisodeNumber='5';
SELECT Episode.EpisodeNumber FROM Serie INNER JOIN Episode ON (Serie.ID = Episode.ID) WHERE Episode.EpisodeNumber='6';
SELECT Episode.EpisodeNumber FROM Serie INNER JOIN Episode ON (Serie.ID = Episode.ID) WHERE Episode.EpisodeNumber='7';
SELECT Episode.EpisodeNumber FROM Serie INNER JOIN Episode ON (Serie.ID = Episode.ID) WHERE Episode.EpisodeNumber='8';
SELECT Episode.EpisodeNumber FROM Serie INNER JOIN Episode ON (Serie.ID = Episode.ID) WHERE Episode.EpisodeNumber='9';
